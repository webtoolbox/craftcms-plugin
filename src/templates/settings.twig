{#
/**
 * Website Toolbox Forum plugin for Craft CMS 4.x
 * Website Toolbox Forum Settings.twig
 * @author    Website Toolbox
 * @copyright Copyright (c) 2020 Website Toolbox
 * @link      https://websitetoolbox.com/
 * @package   Website Toolbox Forum
 * @since     4.0.0
 */
#}
{% import "_includes/forms" as forms %}
{% macro errorList(errors) %}
    {% if errors %}
        {{ ul(errors, {class: 'errors'}) }}
    {% endif %}
{% endmacro %}
<table style='width:100%;'>
    {% if (craft.app.getPlugins.getStoredPluginInfo('websitetoolboxforum') ["settings"]["forumUsername"] is  not defined) or (craft.app.request.getParam('forumSettingOption') == 1)  %}     
        <tr>
            <td>
                <b>Please log in to your Website Toolbox account.</b>
                <p>Not a Website Toolbox Forum owner?  
                    <a href="https://www.websitetoolbox.com/craftCMS" target="_blank" style="text-decoration:underline">Create a Forum Now!</a>
                </p>
                <p>Please <a href="https://www.websitetoolbox.com/contact?subject=CraftCMS+Plugin+Setup+Help" style="text-decoration:underline" target="_blank">Contact Customer Support</a> if you need help getting set up. 
                </p>
            </td>
        </tr>
        <tr>
            <td class='pt_20' colspan='2' >
                {{ forms.textField({
                    "label": "Website Toolbox Username"|t("websitetoolboxforum"),
                    "id": "forumUsername",
                    "name": "forumUsername",
                    "value": settings.forumUsername,
                    "required": true
                   })
                }}
            </td>
        </tr>
        <tr>
            <td class='pt_20'  colspan='2'>
                {{ forms.passwordField({
                    "label": "Website Toolbox Password"|t("websitetoolboxforum"),
                    "id": "forumPassword",
                    "name": "forumPassword",
                    "value": settings.forumPassword,
                    "required": true
                   })
                }}
            </td>
        </tr>
    {% else %}
        <tr>
            <td colspan='2'>
                <p>Please                 
                    <a href="https://www.websitetoolbox.com/contact?subject=CraftCMS+Plugin+Setup+Help" style="text-decoration:underline" target="_blank">Contact Customer Support</a> if you need help getting set up.</p>
            </td>
        </tr>
        <tr>
            <td style='width:20%;' class='pt_20'>
                <b>Website Toolbox Username :</b> 
            </td>
            <td class='pt_20'>
                {{craft.app.getPlugins.getStoredPluginInfo('websitetoolboxforum') ["settings"]["forumUsername"]}}&nbsp;&nbsp;<a href="?p=admin/settings/plugins/websitetoolboxforum&forumSettingOption=1" style="text-decoration:underline">Change</a>
            </td>
        </tr>
        <tr>
            <td style='width:20%;'  class='pt_20'><b>Embed the forum :</b></td>
            <td class='pt_20'>
             {{ 
                forms.checkboxField({
                    label: "Yes"|t('app'),
                    id: 'forumEmbedded',
                    name: 'forumEmbedded',
                    checked: settings.forumEmbedded,
                    class : "embedded",
                    default:"checked"
                })
            }} 
            </td>
        </tr>
        <tr>
            <td></td>
            <td>
                <div>Enable this option to have your forum embedded in a page of your website.        
                <br />Disable this option to have your forum load in a full-sized window. You can use the Layout section in your Website Toolbox account to         
                <a href="https://www.websitetoolbox.com/support/making-your-forum-layout-match-your-website-148" target="_blank" style="text-decoration:underline">customize your forum layout to match your website</a> or         
                <a href="https://www.websitetoolbox.com/contact?subject=Customize+Forum+Layout" style="text-decoration:underline" target="_blank">contact Website Toolbox support to customize it for you</a>            
            </div>
            </td>
        </tr>
        <table id='cmUrl'>
            <tr >
                <td style='width:20%;' class='pt_20'><b>Embed Page :</b></td>
                <td class='pt_20'>            
                    {% if settings.communityUrl %}
                        {% set cmUrl = settings.communityUrl %}
                    {% else %}
                        {% set cmUrl = 'forum' %}
                    {% endif %}                
                    {{ 
                        forms.textField({                
                        "id": "communityUrl",
                        "name": "communityUrl",
                        "value": cmUrl,
                        "required": true               
                        })
                    }} 
                    
                    {{ _self.errorList(settings.getErrors('communityUrl')) }}
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <p> 
                        Add a link to the following address in your websiteâ€™s navigation menu: <a id='frmUrl' href="{{ craft.app.sites.primarySite.baseUrl }}{{ settings.communityUrl }}">{{ craft.app.sites.primarySite.baseUrl }}{{ settings.communityUrl }}</a></p> 
                </td>
            </tr>
        </table>
    {% endif %}
        <tr>
            <td colspan='2'>
                {{ 
                    forms.textField({
                        "id": "forumApiKey",
                        "name": "forumApiKey",
                        "value": settings.forumApiKey,
                        class: "classHide"
                    })
                }} 
                {{ 
                    forms.textField
                    ({
                        "id": "forumUrl",
                        "name": "forumUrl",
                        "value": settings.forumUrl,
                        class: "classHide"
                    })
                }}
                <b>Be sure to specify your sign up, log in, and log out page addresses in the <a href="https://www.websitetoolbox.com/tool/members/mb/settings?tab=Single%20Sign%20On" style="text-decoration:underline"> Single Sign On section </a>of Website Toolbox.</b>
            </td>
        </tr>
</table>
<style>
    .pt_20{padding-top:20px !important;}
    .classHide{ display:none; } 
</style>
<script type="text/javascript">
    var baseUrl = "{{ craft.app.sites.primarySite.baseUrl }}";
    var checkbox  = document.getElementById('settings-forumEmbedded');
    if(!checkbox.checked){        
       document.getElementById('settings-cmUrl').style.display = 'none';       
    }
    checkbox.addEventListener('change', (event) => {
        var chk = event.target;
        if (chk.checked) {
            document.getElementById('settings-cmUrl').style.display = 'block';            
        } else {
            document.getElementById('settings-cmUrl').style.display = 'none';            
        }
    });

    var cmrul  = document.getElementById('settings-communityUrl');
    cmrul.addEventListener('keyup', (event) => {
        var letter = /^[a-z\/\_]+$/;
        if(cmrul.value.match(letter) || cmrul.value == ''){
            document.getElementById('settings-frmUrl').text = baseUrl+cmrul.value
        }
    });
</script>